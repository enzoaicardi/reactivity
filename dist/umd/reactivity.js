!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).t={})}(this,(function(t){"use strict";class s{value;i;h;static o=null;static u=null;static use=(t,...e)=>new s(t).use(...e);constructor(t){this.value=t,this.i=new Set,this.h=!1}add(t){this.i.add(t),t.i.add(this)}use(...t){s.u=s.o,s.o=this.h?null:this,this.h||(this.h=!0);const e=this.value(...t);return s.o=s.u,e}delete(t){this.i.delete(t),t.i.delete(this)}clear(){for(const t of this.i)t.i.delete(this);this.i.clear()}}class e{value;i;constructor(t){void 0!==t&&(this.value=t),this.i=new Set}get(){const t=s.o;return t&&(this.i.add(t),t.i.add(this)),this.value}set(t){if(this.value!==t){this.value=t;for(const t of this.i)t.use()}return this.value}delete(t){this.i.delete(t),t.i.delete(this)}clear(){for(const t of this.i)t.i.delete(this);this.i.clear()}}t.l=class extends e{p;v;entry;constructor(t){super(),this.p=t,this.v=new s((()=>this.set(this.entry))),this.v.use()}set(t){return this.entry=t,t=this.p(t),super.set(t)}clear(){delete this.entry,this.v&&this.v.clear(),super.clear()}},t.m=s,t.S=e}));
